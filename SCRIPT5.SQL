USE `NOTAFISCAL`;
DROP procedure IF EXISTS `TOTAL_50`;

DELIMITER $$
USE `NOTAFISCAL`$$
CREATE DEFINER=`root`@`%` PROCEDURE `TOTAL_50`()
BEGIN

	CREATE TEMPORARY TABLE IF NOT EXISTS EXAME_TMP(
		IDNF INT,
    DATACADASTRO DATE,
    QTDE INT
  );

  INSERT INTO EXAME_TMP (IDNF)
    SELECT EINF.IDNF FROM NOTAFISCAL.EXAME_ITEM_NF AS EINF WHERE EINF.VALOR < 50;

  UPDATE EXAME_TMP AS ET
    JOIN EXAME_NF AS ENF ON ENF.IDNF=ET.IDNF
    SET ET.DATACADASTRO=ET.DATACADASTRO, ET.QTDE=COUNT(ENF.IDNF);

  SELECT * FROM EXAME_TMP;

END$$

DELIMITER ;

